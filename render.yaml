services:
  # Backend API (Node Express)
  - type: web
    name: social-gaming-api
    env: node
    plan: free
    branch: main
    rootDirectory: backend
    buildCommand: npm ci
    startCommand: npm start
    autoDeploy: true
    healthCheckPath: /health
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: social-gaming-db
          property: connectionString
      - key: DB_SSL
        value: "true"
      # Do not set PORT manually; Render injects PORT and app should use it

  # Frontend Static Site (Expo Web export)
  - type: static_site
    name: social-gaming-app
    plan: free
    branch: main
    rootDirectory: social-gaming-app
    buildCommand: npm ci && npm run build:web
    publishPath: web-build
    autoDeploy: true
    envVars:
      - key: EXPO_PUBLIC_API_BASE
        fromService:
          name: social-gaming-api
          type: web
          property: url

databases:
  - name: social-gaming-db
    plan: free
    databaseName: social_gaming
    user: social_gaming_user